import{s as G,a as O,S as v}from"./chunk-DI55MBZ5-BjRNBqoo.js";import{_ as m,c as t,d as D,l as S,e as P,k as z,a9 as R,aa as U,a6 as C,u as _}from"./AugmentMessage-BHgnxRkx.js";import{G as W}from"./graph-DDuBh4w2.js";import{l as F}from"./layout-UrDMVz7U.js";import"./chunk-55IACEB6-CxCjPgYh.js";import"./chunk-QN33PNHL-DJcFsNO3.js";import"./TextAugment-CCgoKCVh.js";import"./index-B9uIMiyK.js";import"./preload-helper-iZIsTGZK.js";import"./await-Bft3-TRy.js";import"./index-B4NDmpYR.js";import"./IconButtonAugment-CsdawHyK.js";/* empty css                                                */import"./Store-CzuxPCq8.js";import"./CardAugment-Bqwu5ahx.js";import"./focusTrapStack-9JCo5vKi.js";import"./Chevron-Cl2ZClCm.js";import"./BaseTextInput-CKEk7GUD.js";import"./message-broker-CppRv-qk.js";import"./index-BuNY6jLF.js";import"./index-Bz1AJAWu.js";import"./chat-model-DaVfYv7o.js";import"./file-type-utils-CBkYZ4gj.js";import"./CalloutAugment-BUb-HAQ6.js";import"./types-DGsjtdxm.js";import"./chat-model-context-DwFUhpQk.js";import"./Markdown-F1hzawoT.js";import"./CollapseButtonAugment-CdECN-QQ.js";import"./toggleHighContrast-BIKVVoPO.js";import"./ButtonAugment-dm8Gq3Cq.js";import"./Filespan-DQTy5qup.js";import"./OpenFileButton-DcM9qoQQ.js";import"./index-Czcl53hR.js";import"./remote-agents-client-3ykFyqEs.js";import"./SuccessfulButton-CqblPP5m.js";import"./CopyButton-CYoKSKPU.js";import"./LanguageIcon-BRHvdy0u.js";import"./keypress-fD7XHdyk.js";import"./TextAreaAugment-Pjr5jpcU.js";import"./partner-mcp-utils-8KSbNsEE.js";import"./augment-logo-CnRinIIJ.js";import"./utils-BOGwHecm.js";import"./_baseUniq-uDqqXzFx.js";import"./_basePickBy-iiVghp6f.js";try{M=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},(H=new M.Error().stack)&&(M._sentryDebugIds=M._sentryDebugIds||{},M._sentryDebugIds[H]="38484c20-ff10-4c7b-9f21-6ab59fdbc4ad",M._sentryDebugIdIdentifier="sentry-dbid-38484c20-ff10-4c7b-9f21-6ab59fdbc4ad")}catch{}var M,H,w,J=m(e=>e.append("circle").attr("class","start-state").attr("r",t().state.sizeUnit).attr("cx",t().state.padding+t().state.sizeUnit).attr("cy",t().state.padding+t().state.sizeUnit),"drawStartState"),j=m(e=>e.append("line").style("stroke","grey").style("stroke-dasharray","3").attr("x1",t().state.textHeight).attr("class","divider").attr("x2",2*t().state.textHeight).attr("y1",0).attr("y2",0),"drawDivider"),Y=m((e,i)=>{const p=e.append("text").attr("x",2*t().state.padding).attr("y",t().state.textHeight+2*t().state.padding).attr("font-size",t().state.fontSize).attr("class","state-title").text(i.id),s=p.node().getBBox();return e.insert("rect",":first-child").attr("x",t().state.padding).attr("y",t().state.padding).attr("width",s.width+2*t().state.padding).attr("height",s.height+2*t().state.padding).attr("rx",t().state.radius),p},"drawSimpleState"),$=m((e,i)=>{const p=m(function(o,u,b){const B=o.append("tspan").attr("x",2*t().state.padding).text(u);b||B.attr("dy",t().state.textHeight)},"addTspan"),s=e.append("text").attr("x",2*t().state.padding).attr("y",t().state.textHeight+1.3*t().state.padding).attr("font-size",t().state.fontSize).attr("class","state-title").text(i.descriptions[0]).node().getBBox(),n=s.height,h=e.append("text").attr("x",t().state.padding).attr("y",n+.4*t().state.padding+t().state.dividerMargin+t().state.textHeight).attr("class","state-description");let l=!0,a=!0;i.descriptions.forEach(function(o){l||(p(h,o,a),a=!1),l=!1});const d=e.append("line").attr("x1",t().state.padding).attr("y1",t().state.padding+n+t().state.dividerMargin/2).attr("y2",t().state.padding+n+t().state.dividerMargin/2).attr("class","descr-divider"),x=h.node().getBBox(),c=Math.max(x.width,s.width);return d.attr("x2",c+3*t().state.padding),e.insert("rect",":first-child").attr("x",t().state.padding).attr("y",t().state.padding).attr("width",c+2*t().state.padding).attr("height",x.height+n+2*t().state.padding).attr("rx",t().state.radius),e},"drawDescrState"),X=m((e,i,p)=>{const s=t().state.padding,n=2*t().state.padding,h=e.node().getBBox(),l=h.width,a=h.x,d=e.append("text").attr("x",0).attr("y",t().state.titleShift).attr("font-size",t().state.fontSize).attr("class","state-title").text(i.id),x=d.node().getBBox().width+n;let c,o=Math.max(x,l);o===l&&(o+=n);const u=e.node().getBBox();i.doc,c=a-s,x>l&&(c=(l-o)/2+s),Math.abs(a-u.x)<s&&x>l&&(c=a-(x-l)/2);const b=1-t().state.textHeight;return e.insert("rect",":first-child").attr("x",c).attr("y",b).attr("class",p?"alt-composit":"composit").attr("width",o).attr("height",u.height+t().state.textHeight+t().state.titleShift+1).attr("rx","0"),d.attr("x",c+s),x<=l&&d.attr("x",a+(o-n)/2-x/2+s),e.insert("rect",":first-child").attr("x",c).attr("y",t().state.titleShift-t().state.textHeight-t().state.padding).attr("width",o).attr("height",3*t().state.textHeight).attr("rx",t().state.radius),e.insert("rect",":first-child").attr("x",c).attr("y",t().state.titleShift-t().state.textHeight-t().state.padding).attr("width",o).attr("height",u.height+3+2*t().state.textHeight).attr("rx",t().state.radius),e},"addTitleAndBox"),q=m(e=>(e.append("circle").attr("class","end-state-outer").attr("r",t().state.sizeUnit+t().state.miniPadding).attr("cx",t().state.padding+t().state.sizeUnit+t().state.miniPadding).attr("cy",t().state.padding+t().state.sizeUnit+t().state.miniPadding),e.append("circle").attr("class","end-state-inner").attr("r",t().state.sizeUnit).attr("cx",t().state.padding+t().state.sizeUnit+2).attr("cy",t().state.padding+t().state.sizeUnit+2)),"drawEndState"),Z=m((e,i)=>{let p=t().state.forkWidth,s=t().state.forkHeight;if(i.parentId){let n=p;p=s,s=n}return e.append("rect").style("stroke","black").style("fill","black").attr("width",p).attr("height",s).attr("x",t().state.padding).attr("y",t().state.padding)},"drawForkJoinState"),K=m((e,i,p,s)=>{let n=0;const h=s.append("text");h.style("text-anchor","start"),h.attr("class","noteText");let l=e.replace(/\r\n/g,"<br/>");l=l.replace(/\n/g,"<br/>");const a=l.split(z.lineBreakRegex);let d=1.25*t().state.noteMargin;for(const x of a){const c=x.trim();if(c.length>0){const o=h.append("tspan");o.text(c),d===0&&(d+=o.node().getBBox().height),n+=d,o.attr("x",i+t().state.noteMargin),o.attr("y",p+n+1.25*t().state.noteMargin)}}return{textWidth:h.node().getBBox().width,textHeight:n}},"_drawLongText"),Q=m((e,i)=>{i.attr("class","state-note");const p=i.append("rect").attr("x",0).attr("y",t().state.padding),s=i.append("g"),{textWidth:n,textHeight:h}=K(e,0,0,s);return p.attr("height",h+2*t().state.noteMargin),p.attr("width",n+2*t().state.noteMargin),p},"drawNote"),I=m(function(e,i){const p=i.id,s={id:p,label:i.id,width:0,height:0},n=e.append("g").attr("id",p).attr("class","stateGroup");i.type==="start"&&J(n),i.type==="end"&&q(n),i.type!=="fork"&&i.type!=="join"||Z(n,i),i.type==="note"&&Q(i.note.text,n),i.type==="divider"&&j(n),i.type==="default"&&i.descriptions.length===0&&Y(n,i),i.type==="default"&&i.descriptions.length>0&&$(n,i);const h=n.node().getBBox();return s.width=h.width+2*t().state.padding,s.height=h.height+2*t().state.padding,s},"drawState"),L=0,V=m(function(e,i,p){const s=m(function(d){switch(d){case v.relationType.AGGREGATION:return"aggregation";case v.relationType.EXTENSION:return"extension";case v.relationType.COMPOSITION:return"composition";case v.relationType.DEPENDENCY:return"dependency"}},"getRelationType");i.points=i.points.filter(d=>!Number.isNaN(d.y));const n=i.points,h=R().x(function(d){return d.x}).y(function(d){return d.y}).curve(U),l=e.append("path").attr("d",h(n)).attr("id","edge"+L).attr("class","transition");let a="";if(t().state.arrowMarkerAbsolute&&(a=C(!0)),l.attr("marker-end","url("+a+"#"+s(v.relationType.DEPENDENCY)+"End)"),p.title!==void 0){const d=e.append("g").attr("class","stateLabel"),{x,y:c}=_.calcLabelPosition(i.points),o=z.getRows(p.title);let u=0;const b=[];let B=0,N=0;for(let f=0;f<=o.length;f++){const g=d.append("text").attr("text-anchor","middle").text(o[f]).attr("x",x).attr("y",c+u),y=g.node().getBBox();B=Math.max(B,y.width),N=Math.min(N,y.x),S.info(y.x,x,c+u),u===0&&(u=g.node().getBBox().height,S.info("Title height",u,c)),b.push(g)}let E=u*o.length;if(o.length>1){const f=(o.length-1)*u*.5;b.forEach((g,y)=>g.attr("y",c+y*u-f)),E=u*o.length}const r=d.node().getBBox();d.insert("rect",":first-child").attr("class","box").attr("x",x-B/2-t().state.padding/2).attr("y",c-E/2-t().state.padding/2-3.5).attr("width",B+t().state.padding).attr("height",E+t().state.padding),S.info(r)}L++},"drawEdge"),T={},tt=m(function(){},"setConf"),et=m(function(e){e.append("defs").append("marker").attr("id","dependencyEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 19,7 L9,13 L14,7 L9,1 Z")},"insertMarkers"),at=m(function(e,i,p,s){w=t().state;const n=t().securityLevel;let h;n==="sandbox"&&(h=D("#i"+i));const l=D(n==="sandbox"?h.nodes()[0].contentDocument.body:"body"),a=n==="sandbox"?h.nodes()[0].contentDocument:document;S.debug("Rendering diagram "+e);const d=l.select(`[id='${i}']`);et(d);const x=s.db.getRootDoc();A(x,d,void 0,!1,l,a,s);const c=w.padding,o=d.node().getBBox(),u=o.width+2*c,b=o.height+2*c;P(d,b,1.75*u,w.useMaxWidth),d.attr("viewBox",`${o.x-w.padding}  ${o.y-w.padding} `+u+" "+b)},"draw"),it=m(e=>e?e.length*w.fontSizeFactor:1,"getLabelWidth"),A=m((e,i,p,s,n,h,l)=>{const a=new W({compound:!0,multigraph:!0});let d,x=!0;for(d=0;d<e.length;d++)if(e[d].stmt==="relation"){x=!1;break}p?a.setGraph({rankdir:"LR",multigraph:!0,compound:!0,ranker:"tight-tree",ranksep:x?1:w.edgeLengthFactor,nodeSep:x?1:50,isMultiGraph:!0}):a.setGraph({rankdir:"TB",multigraph:!0,compound:!0,ranksep:x?1:w.edgeLengthFactor,nodeSep:x?1:50,ranker:"tight-tree",isMultiGraph:!0}),a.setDefaultEdgeLabel(function(){return{}});const c=l.db.getStates(),o=l.db.getRelations(),u=Object.keys(c);for(const r of u){const f=c[r];let g;if(p&&(f.parentId=p),f.doc){let y=i.append("g").attr("id",f.id).attr("class","stateGroup");g=A(f.doc,y,f.id,!s,n,h,l);{y=X(y,f,s);let k=y.node().getBBox();g.width=k.width,g.height=k.height+w.padding/2,T[f.id]={y:w.compositTitleSize}}}else g=I(i,f,a);if(f.note){const y={descriptions:[],id:f.id+"-note",note:f.note,type:"note"},k=I(i,y,a);f.note.position==="left of"?(a.setNode(g.id+"-note",k),a.setNode(g.id,g)):(a.setNode(g.id,g),a.setNode(g.id+"-note",k)),a.setParent(g.id,g.id+"-group"),a.setParent(g.id+"-note",g.id+"-group")}else a.setNode(g.id,g)}S.debug("Count=",a.nodeCount(),a);let b=0;o.forEach(function(r){b++,S.debug("Setting edge",r),a.setEdge(r.id1,r.id2,{relation:r,width:it(r.title),height:w.labelHeight*z.getRows(r.title).length,labelpos:"c"},"id"+b)}),F(a),S.debug("Graph after layout",a.nodes());const B=i.node();a.nodes().forEach(function(r){r!==void 0&&a.node(r)!==void 0?(S.warn("Node "+r+": "+JSON.stringify(a.node(r))),n.select("#"+B.id+" #"+r).attr("transform","translate("+(a.node(r).x-a.node(r).width/2)+","+(a.node(r).y+(T[r]?T[r].y:0)-a.node(r).height/2)+" )"),n.select("#"+B.id+" #"+r).attr("data-x-shift",a.node(r).x-a.node(r).width/2),h.querySelectorAll("#"+B.id+" #"+r+" .divider").forEach(f=>{const g=f.parentElement;let y=0,k=0;g&&(g.parentElement&&(y=g.parentElement.getBBox().width),k=parseInt(g.getAttribute("data-x-shift"),10),Number.isNaN(k)&&(k=0)),f.setAttribute("x1",0-k+8),f.setAttribute("x2",y-k-8)})):S.debug("No Node "+r+": "+JSON.stringify(a.node(r)))});let N=B.getBBox();a.edges().forEach(function(r){r!==void 0&&a.edge(r)!==void 0&&(S.debug("Edge "+r.v+" -> "+r.w+": "+JSON.stringify(a.edge(r))),V(i,a.edge(r),a.edge(r).relation))}),N=B.getBBox();const E={id:p||"root",label:p||"root",width:0,height:0};return E.width=N.width+2*w.padding,E.height=N.height+2*w.padding,S.debug("Doc rendered",E,a),E},"renderDoc"),rt={setConf:tt,draw:at},qt={parser:O,get db(){return new v(1)},renderer:rt,styles:G,init:m(e=>{e.state||(e.state={}),e.state.arrowMarkerAbsolute=e.arrowMarkerAbsolute},"init")};export{qt as diagram};
//# sourceMappingURL=stateDiagram-FKZM4ZOC-BfODEK3X.js.map
