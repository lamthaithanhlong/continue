import{aj as tt,aG as pe,aF as Ae,w as ne,aY as Re,W as D,aU as Z,aZ as Ee,aR as Se,t as ue,u as ee,x as b,K as ce,a0 as Ve,C as n,E as V,n as g,L as Ce,F as he,ak as qe,A as S,J as w,I as H,a6 as x,O as $,am as ze,M as _e,a4 as we,G as M,Q as F,aD as Pe,z as ke,N as Le,a9 as Ue,P as be,aa as Ne,Y as ye,a5 as it,a7 as st,an as Ie,aA as nt,af as ot,aE as rt}from"./TextAugment-CCgoKCVh.js";import"./design-system-init-D_ikSdGN.js";import{e as Be,i as Ze,d as He,c as at,I as Ge}from"./IconButtonAugment-CsdawHyK.js";import{d as dt}from"./index-B4NDmpYR.js";import{F as lt,C as Ye}from"./chat-model-DaVfYv7o.js";import{r as ut,a as Te}from"./monaco-render-utils-BmFM_Kj0.js";import{M as Ke}from"./message-broker-CppRv-qk.js";import{e as ct,g as ht,u as ft,d as gt,S as mt,F as pt}from"./Store-CzuxPCq8.js";import{B as ie}from"./ButtonAugment-dm8Gq3Cq.js";import{T as _t,a as vt}from"./CardAugment-Bqwu5ahx.js";/* empty css                                                */import{K as Ct,A as kt,R as We,P as bt}from"./Keybindings-CIVfIIto.js";import{s as yt}from"./chat-model-context-DwFUhpQk.js";import{a as wt,M as Mt,b as Et,C as It}from"./index-BuNY6jLF.js";import"./file-type-utils-CBkYZ4gj.js";import"./CalloutAugment-BUb-HAQ6.js";import"./types-DGsjtdxm.js";import"./index-Bz1AJAWu.js";import"./focusTrapStack-9JCo5vKi.js";import"./Chevron-Cl2ZClCm.js";import"./BaseTextInput-CKEk7GUD.js";import"./Filespan-DQTy5qup.js";import"./TextCombo-BcswIAtX.js";import"./augment-logo-CnRinIIJ.js";try{de=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},(Fe=new de.Error().stack)&&(de._sentryDebugIds=de._sentryDebugIds||{},de._sentryDebugIds[Fe]="4f154bf0-170e-475e-9aee-f62b240cb9c1",de._sentryDebugIdIdentifier="sentry-dbid-4f154bf0-170e-475e-9aee-f62b240cb9c1")}catch{}var de,Fe;function Qe(d){return function(e){return"unitOfCodeWork"in e&&!function(t){return t.children.length>0&&"childIds"in t}(e)}(d)?[d]:d.children.flatMap(Qe)}var le=(d=>(d.edit="edit",d.instruction="instruction",d))(le||{}),xe=(d=>(d[d.instructionDrawer=0]="instructionDrawer",d[d.chunkActionPanel=1]="chunkActionPanel",d))(xe||{});class St{constructor(e,t,i){this.id=e,this.originalCode=t,this._monaco=i,this._originalModel=this._monaco.editor.createModel(t),this._modifiedModel=this._monaco.editor.createModel(t)}_originalModel;_modifiedModel;_fullEdits=[];_currEdit;_currOriginalEdit;swapBaseModel=e=>{this._originalModel.setValue(e),this._modifiedModel.setValue(e),this._fullEdits.forEach(t=>{this._modifiedModel.applyEdits([t])}),this._currEdit&&this._modifiedModel.applyEdits([this._currEdit]),this._currOriginalEdit&&this._originalModel.applyEdits([this._currOriginalEdit])};finish=()=>this._completeCurrEdit();onReceiveChunk=e=>e.data.newChunkStart?this._startNewEdit(e.data.newChunkStart):e.data.chunkContinue&&this._currEdit?this._continueEdit(e.data.chunkContinue):e.data.chunkEnd&&this._currEdit?this._completeCurrEdit(e.data.chunkEnd):void 0;get hasReceivedFirstChunk(){return this._currEdit!==void 0||this._fullEdits.length>0}get originalValue(){return this._originalModel.getValue()}get modifiedValue(){return this._modifiedModel.getValue()}get currEdit(){return this._currEdit}_completeCurrEdit=e=>{const t={resetOriginal:[],original:[],modified:[]};if(!e)return t;if(this._currEdit){this._currEdit.range=new this._monaco.Range(e.stagedStartLine,0,e.stagedEndLine,0);const i=this._nextModifiedInsertPosition(),s=e.stagedEndLine-e.stagedStartLine,o={range:new this._monaco.Range(i.lineNumber,0,i.lineNumber+s,0),text:""};t.modified.push(o),this._modifiedModel.applyEdits([o]),this._fullEdits.push(this._currEdit),this._currEdit=void 0}return t};_startNewEdit=e=>{const t={resetOriginal:[],original:[],modified:[]};return this._currOriginalEdit=void 0,this._currEdit={range:new this._monaco.Range(e.stagedStartLine,0,e.stagedStartLine,0),text:""},t.modified.push(this._currEdit),this._modifiedModel.applyEdits([this._currEdit]),t};_continueEdit=e=>{if(!this._currEdit)throw new Error("No current edit");const t=this._nextModifiedInsertPosition(),i={...this._currEdit,text:e.newText,range:new this._monaco.Range(t.lineNumber,t.column,t.lineNumber,t.column)};return this._modifiedModel.applyEdits([i]),this._currEdit.text+=e.newText,{resetOriginal:[],original:[],modified:e.newText.length>0?[i]:[]}};_nextModifiedInsertPosition=()=>{if(!this._currEdit)throw new Error("No current edit");const e=this._modifiedModel.getOffsetAt({lineNumber:this._currEdit.range.startLineNumber,column:this._currEdit.range.startColumn})+(this._currEdit.text?.length??0);return this._modifiedModel.getPositionAt(e)}}class Lt{constructor(e,t,i){this._editorContainer=e,this._monaco=i,this._asyncMsgSender=new tt(s=>pe.postMessage(s)),this.initializeEditor(t)}_asyncMsgSender;_editor;_chatModel;_focusModel=new lt;_hasScrolledOnInit=!1;_markHasScrolledOnInit=Ae(()=>{this._hasScrolledOnInit=!0},200);_resetScrollOnInit=()=>{this._markHasScrolledOnInit.cancel(),this._hasScrolledOnInit=!1};_subscribers=new Set;_disposables=[];_rootChunk;_keybindings=ne({});_requestId=ne(void 0);requestId=this._requestId;_disableResolution=ne(!1);disableResolution=Re(this._disableResolution);_disableApply=ne(!1);disableApply=Re(this._disableApply);_currStream;_isLoadingDiffChunks=ne(!1);_selectionLines=ne(void 0);_mode=ne(le.edit);initializeEditor=e=>{this._editor=this._monaco.editor.createDiffEditor(this._editorContainer,{automaticLayout:!0,theme:e,readOnly:!0,contextmenu:!1,renderSideBySide:!1,renderIndicators:!0,renderMarginRevertIcon:!1,originalEditable:!1,diffCodeLens:!1,renderOverviewRuler:!1,ignoreTrimWhitespace:!1,scrollBeyondLastLine:!0,maxComputationTime:0,minimap:{enabled:!1},padding:{top:16}}),this._editor.getOriginalEditor().updateOptions({lineNumbers:"off"}),this._chatModel=new Ye(new Ke(pe),pe,ct().store,{}),this._monaco.editor.registerCommand?.("acceptFocusedChunk",this.acceptFocusedChunk),this._monaco.editor.registerCommand?.("rejectFocusedChunk",this.rejectFocusedChunk),this._monaco.editor.registerCommand?.("acceptAllChunks",this.acceptAllChunks),this._monaco.editor.registerCommand?.("rejectAllChunks",this.rejectAllChunks),this._monaco.editor.registerCommand?.("focusNextChunk",this.focusNextChunk),this._monaco.editor.registerCommand?.("focusPrevChunk",this.focusPrevChunk),this._disposables.push(this._editor,this._editor.onDidUpdateDiff(this.onDidUpdateDiff),this._editor.getModifiedEditor().onMouseMove(this.onMouseMoveModified),{dispose:this._focusModel.subscribe(t=>this.notifySubscribers())}),this.initialize()};subscribe=e=>(this._subscribers.add(e),e(this),()=>{this._subscribers.delete(e)});dispose=()=>{this._editor.dispose(),this._subscribers.clear(),this._disposables.forEach(e=>e.dispose())};notifySubscribers=()=>{this._subscribers.forEach(e=>e(this))};onDidUpdateDiff=()=>{if(this.updateCodeChunk(),!this._hasScrolledOnInit&&this.leaves?.length){this._markHasScrolledOnInit();const e=this.leaves[0];this.revealChunk(e)}this.notifyDiffViewUpdated(),this.notifySubscribers()};onMouseMoveModified=e=>{if(e.target.position?.lineNumber===void 0||this.leaves===void 0)return;const t=this.editorOffset,i=e.target.position?.lineNumber;for(let s=0;s<this.leaves.length;s++){const o=this.leaves[s],r=o.unitOfCodeWork.lineChanges?.lineChanges[0].modifiedStart,a=o.unitOfCodeWork.lineChanges?.lineChanges[0].modifiedEnd,f=o.unitOfCodeWork.lineChanges?.lineChanges[0].originalStart,m=o.unitOfCodeWork.lineChanges?.lineChanges[0].originalEnd;if(r!==void 0&&a!==void 0&&f!==void 0&&m!==void 0){if(r!==a||i!==r){if(r<=i&&i<a){this.setCurrFocusedChunkIdx(s,!1);break}}else if(e.target.type===this._monaco.editor.MouseTargetType.CONTENT_VIEW_ZONE){const l=this._editor.getOriginalEditor(),u=l.getOption(this._monaco.editor.EditorOption.lineHeight),I=l.getScrolledVisiblePosition({lineNumber:f,column:0}),p=l.getScrolledVisiblePosition({lineNumber:m+1,column:0});if(I===null||p===null)continue;const _=I.top-u/2+t,L=p.top-u/2+t;if(e.event.posy>=_&&e.event.posy<=L){this.setCurrFocusedChunkIdx(s,!1);break}break}}}};get editorOffset(){return this._editorContainer.getBoundingClientRect().top}get currFocusedChunkIdx(){return this._focusModel.focusedItemIdx}get selectionLines(){return this._selectionLines}get mode(){return this._mode}get keybindings(){return this._keybindings}getOriginalEditor(){return this._editor.getOriginalEditor()}getModifiedEditor(){return this._editor.getModifiedEditor()}get isLoading(){return{subscribe:this._isLoadingDiffChunks.subscribe}}setLoading(e){this._isLoadingDiffChunks.set(e)}updateIsWebviewFocused=async e=>{await this._asyncMsgSender.send({type:D.diffViewWindowFocusChange,data:e})};setCurrFocusedChunkIdx=(e,t=!0)=>{this._focusModel.focusedItemIdx!==e&&(this._focusModel.setFocusIdx(e),t&&this.revealCurrFocusedChunk(),this.notifySubscribers())};revealCurrFocusedChunk=()=>{const e=this._focusModel.focusedItem;e&&this.revealChunk(e)};revealChunk=e=>{const t=e.unitOfCodeWork.lineChanges?.lineChanges[0],i=t?.modifiedStart;i!==void 0&&this._editor.revealLineNearTop(i-1)};renderCentralOverlayWidget=e=>{const t=()=>({editor:this._editor,id:"central-overlay-widget"}),i=ut(e,t(),{monaco:this._monaco});return{update:()=>{i.update(t())},destroy:i.destroy}};renderInstructionsDrawerViewZone=(e,t)=>{let i=!1,s=t;const o=t.autoFocus??!0,r=l=>{o&&!i&&(this._editor.revealLineNearTop(l),i=!0)},a=l=>({...l,ordinal:xe.instructionDrawer,editor:this._editor,afterLineNumber:l.line}),f=Te(e,a(t)),m=[];return o&&m.push(this._editor.onDidUpdateDiff(()=>{r(s.line)})),{update:l=>{const u={...s,...l};dt(u,s)||(f.update(a(u)),s=u,r(u.line))},destroy:()=>{f.destroy(),m.forEach(l=>l.dispose())}}};renderActionsViewZone=(e,t)=>{const i=o=>{let r;return r=o.chunk?o.chunk.unitOfCodeWork.lineChanges?.lineChanges[0].modifiedStart:1,{...o,ordinal:xe.chunkActionPanel,editor:this._editor,afterLineNumber:r?r-1:void 0}},s=Te(e,i(t));return{update:o=>{s.update(i(o))},destroy:s.destroy}};acceptAllChunks=()=>{this.leaves&&this.acceptChunks(this.leaves,!0)};rejectAllChunks=()=>{this.leaves&&this.rejectChunks(this.leaves,!0)};acceptFocusedChunk=()=>{const e=this._focusModel.focusedItem;e&&this.acceptChunk(e)};rejectFocusedChunk=()=>{const e=this._focusModel.focusedItem;e&&this.rejectChunk(e)};focusNextChunk=()=>{this._focusModel.focusNext(),this.revealCurrFocusedChunk()};focusPrevChunk=()=>{this._focusModel.focusPrev(),this.revealCurrFocusedChunk()};initialize=async()=>{const e=await this._asyncMsgSender.send({type:D.diffViewLoaded},2e3);this._resetScrollOnInit();const{file:t,instruction:i,keybindings:s,editable:o}=e.data;this._editor.updateOptions({readOnly:!o});const r=Z(this._keybindings);this._keybindings.set(s??r);const a=i?.selection;a&&(a.start.line===a.end.line&&a.start.character===a.end.character&&this._mode.set(le.instruction),Z(this.selectionLines)===void 0&&this._selectionLines.set({start:a.start.line,end:a.end.line})),this.updateModels(t.originalCode??"",t.modifiedCode??"",{rootPath:t.repoRoot,relPath:t.pathName}),this._currStream?.finish(),this._currStream=void 0,this._disableResolution.set(!!e.data.disableResolution),this._disableApply.set(!!e.data.disableApply),await this._tryFetchStream(),this._syncStreamToModels()};disposeDiffViewPanel=async()=>{await this._asyncMsgSender.send({type:D.disposeDiffView})};_tryFetchStream=async()=>{const e=this._asyncMsgSender.stream({type:D.diffViewFetchPendingStream},15e3,6e4);for await(const t of e)switch(t.type){case D.diffViewDiffStreamStarted:{this.setLoading(!0),this._requestId.set(t.data.requestId);const i=this._editor.getOriginalEditor().getValue();this._currStream=new St(t.data.streamId,i,this._monaco),this._syncStreamToModels();break}case D.diffViewDiffStreamEnded:if(this._currStream?.id!==t.data.streamId)return;this.setLoading(!1),this._cleanupStream();break;case D.diffViewDiffStreamChunk:{if(this._currStream?.id!==t.data.streamId)return;const i=this._editor.getOriginalEditor().getModel();if(!this._editor.getModifiedEditor().getModel()||!i)return this.setLoading(!1),void this._cleanupStream();const s=this._currStream?.onReceiveChunk(t);s&&(this._applyDeltaDiff(s),Z(this._selectionLines)!=null&&this._selectionLines.set(null));break}}};handleMessageFromExtension=async e=>{switch(e.data.type){case D.diffViewNotifyReinit:this.setLoading(!1),this._cleanupStream(),this.initialize();break;case D.diffViewAcceptAllChunks:this.acceptAllChunks();break;case D.diffViewAcceptFocusedChunk:this.acceptFocusedChunk();break;case D.diffViewRejectFocusedChunk:this.rejectFocusedChunk();break;case D.diffViewFocusPrevChunk:this.focusPrevChunk();break;case D.diffViewFocusNextChunk:this.focusNextChunk()}};_applyDeltaDiff=e=>{const t=this._editor.getOriginalEditor().getModel(),i=this._editor.getModifiedEditor().getModel();t&&i&&(t.pushEditOperations([],e.resetOriginal,()=>[]),e.original.forEach(s=>{t.pushEditOperations([],[s],()=>[])}),e.modified.forEach(s=>{i.pushEditOperations([],[s],()=>[])}))};_cleanupStream=()=>{if(this._currStream){const e=this._currStream?.finish();this._applyDeltaDiff(e),this._currStream=void 0,this._resetScrollOnInit()}};_syncStreamToModels=()=>{const e=this._currStream?.originalValue,t=this._currStream?.modifiedValue;e&&e!==this._editor.getOriginalEditor().getValue()&&this._editor.getOriginalEditor().setValue(e),t&&t!==this._editor.getModifiedEditor().getValue()&&this._editor.getModifiedEditor().setValue(t)};acceptChunk=async e=>{Z(this._disableApply)||this.acceptChunks([e])};acceptChunks=async(e,t=!1)=>{Z(this._disableApply)||(this.executeDiffChunks(e,!0),this.notifyResolvedChunks(e,Ee.accept,t),await Se(),this.areModelsEqual()&&!Z(this.isLoading)&&this.disposeDiffViewPanel())};areModelsEqual=()=>{const e=this._editor.getModel()?.original,t=this._editor.getModel()?.modified;return e?.getValue()===t?.getValue()};rejectChunk=async e=>{this.rejectChunks([e])};rejectChunks=async(e,t=!1)=>{this.executeDiffChunks(e,!1),this.notifyResolvedChunks(e,Ee.reject,t),await Se(),this.areModelsEqual()&&!Z(this.isLoading)&&this.disposeDiffViewPanel()};get _originalCode(){return this._currStream?.originalCode??this._editor.getOriginalEditor().getValue()}get _modifiedCode(){return this._editor.getModifiedEditor().getValue()}notifyDiffViewUpdated=Ae(()=>{this.notifyResolvedChunks([],Ee.accept)},1e3);notifyResolvedChunks=async(e,t,i=!1)=>{const s=this._editor.getModel()?.original.uri.path;s&&await this._asyncMsgSender.send({type:D.diffViewResolveChunk,data:{file:{repoRoot:"",pathName:s,originalCode:this._originalCode,modifiedCode:this._modifiedCode},changes:e.map(o=>o.unitOfCodeWork),resolveType:t,shouldApplyToAll:i}},2e3)};executeDiffChunks=(e,t)=>{if(Z(this._disableResolution)||t&&Z(this._disableApply))return;const i=this._editor.getModel()?.original,s=this._editor.getModel()?.modified;if(!i||!s||this._currStream!==void 0)return;const o=[],r=[];for(const l of e){const u=l.unitOfCodeWork.lineChanges?.lineChanges[0];if(!u||l.unitOfCodeWork.originalCode===void 0||l.unitOfCodeWork.modifiedCode===void 0)continue;let I={startLineNumber:u.originalStart,startColumn:1,endLineNumber:u.originalEnd,endColumn:1},p={startLineNumber:u.modifiedStart,startColumn:1,endLineNumber:u.modifiedEnd,endColumn:1};const _=t?l.unitOfCodeWork.modifiedCode:l.unitOfCodeWork.originalCode;_!==void 0&&(o.push({range:I,text:_}),r.push({range:p,text:_}))}i.pushEditOperations([],o,()=>[]),s.pushEditOperations([],r,()=>[]);const a=this._focusModel.nextIdx({nowrap:!0});if(a===void 0)return;const f=a===this._focusModel.focusedItemIdx?a-1:a,m=this._focusModel.items[f];m&&this.revealChunk(m)};get leaves(){const e=this.codeChunk;if(e)return Qe(e)}get codeChunk(){return this._rootChunk}updateCodeChunk=()=>{this._rootChunk=this.computeCodeChunk(),this._focusModel.setItems(this.leaves??[]),this._focusModel.initFocusIdx(0),this.notifySubscribers()};computeCodeChunk(){const e=[],t=this._editor.getLineChanges(),i=this._editor.getModel()?.original,s=this._editor.getModel()?.modified;if(t&&i&&s){for(const o of t){const r=je({startLineNumber:o.originalStartLineNumber,endLineNumber:o.originalEndLineNumber}),a=je({startLineNumber:o.modifiedStartLineNumber,endLineNumber:o.modifiedEndLineNumber}),f=Nt(this._editor,r,a);e.push(f)}return{id:crypto.randomUUID(),name:"",title:"",description:"",generationSource:"",supportedActions:[],children:e,childIds:e.map(o=>o.id)}}}handleInstructionSubmit=e=>{const t=this._editor.getModifiedEditor(),i=this.getSelectedCodeDetails(t);if(!i)throw Error("No selected code details found");this._chatModel.currentConversationModel.sendInstructionExchange(e,i)};updateModels=(e,t,i)=>{const s=this._editor.getModel()?.original?.uri,o=(i&&this._monaco.Uri.file(i.relPath))??s;if(o)if(s?.fsPath!==o.fsPath||s?.authority!==o.authority){const r=o.with({fragment:crypto.randomUUID()}),a=o.with({fragment:crypto.randomUUID()});this._editor.setModel({original:this._monaco.editor.createModel(e,void 0,r),modified:this._monaco.editor.createModel(t??"",void 0,a)})}else this._originalCode!==e&&this.getOriginalEditor().setValue(e),this._modifiedCode!==t&&this.getModifiedEditor().setValue(t??"");else console.warn("No URI found for diff view. Not updating models.")};updateTheme=e=>{this._monaco.editor.setTheme(e)};getSelectedCodeDetails(e){const t=e.getModel();if(!t)return null;const i=t.getLanguageId(),s=1,o=1,r={lineNumber:t.getLineCount(),column:t.getLineMaxColumn(t.getLineCount())},a=Z(this._selectionLines);if(!a)throw new Error("No selection lines found");const f=Math.min(a.end+1,r.lineNumber),m=new this._monaco.Range(a.start+1,1,f,t.getLineMaxColumn(f));let l=t.getValueInRange(m);f<t.getLineCount()&&(l+=t.getEOL());const u=new this._monaco.Range(s,o,m.startLineNumber,m.startColumn),I=Math.min(m.endLineNumber+1,r.lineNumber),p=new this._monaco.Range(I,1,r.lineNumber,r.column);return{selectedCode:l,prefix:t.getValueInRange(u),suffix:t.getValueInRange(p),path:t.uri.path,language:i,prefixBegin:u.startLineNumber-1,suffixEnd:p.endLineNumber-1}}}function Nt(d,e,t){const i=d.getModel()?.original,s=d.getModel()?.modified;if(!i||!s)throw new Error("No models found");return function(o,r,a,f){return{id:crypto.randomUUID(),name:"",title:"",description:"",generationSource:"",supportedActions:[],unitOfCodeWork:{repoRoot:"",pathName:"",originalCode:o,modifiedCode:r,lineChanges:{lineChanges:[{originalStart:a.startLineNumber,originalEnd:a.endLineNumber,modifiedStart:f.startLineNumber,modifiedEnd:f.endLineNumber}],lineOffset:0}},children:[],childIds:[]}}(i.getValueInRange(e),s.getValueInRange(t),e,t)}function je(d){return d.endLineNumber===0?{startLineNumber:d.startLineNumber+1,startColumn:1,endLineNumber:d.startLineNumber+1,endColumn:1}:{startLineNumber:d.startLineNumber,startColumn:1,endLineNumber:d.endLineNumber+1,endColumn:1}}var xt=b('<span class="c-keyboard-shortcut-hint__icon svelte-1s22lg"> </span>'),Vt=b("<span></span>");function oe(d,e){ue(e,!0);let t=ee(e,"class",3,""),i=ee(e,"keybinding",19,()=>{}),s=ee(e,"icons",19,()=>i()?.split("-")??[]);var o=Vt();Be(o,21,s,Ze,(r,a)=>{var f=xt(),m=V(f);ce(()=>Ve(m,n(a))),g(r,f)}),ce(()=>Ce(o,1,`c-keyboard-shortcut-hint ${t()}`,"svelte-1s22lg")),g(d,o),he()}var Ot=b("<!> Accept",1),Dt=b("<!> Reject",1),$t=b("<div></div>  <div><div><!> <!></div></div>",1);function Ft(d,e){ue(e,!0);const t=()=>x(f,"$keybindingsStore",i),[i,s]=we();let o=ee(e,"align",3,"right"),r=ee(e,"heightInPx",3,1),a=ee(e,"disableApply",3,!1);const f=e.diffViewModel.keybindings;let m=$(0);const l=h=>{M(m,h,!0)};let u,I=$(!1);function p(){u&&(clearTimeout(u),u=void 0),M(I,!1)}function _(h){h.target.closest(".c-button-container")?p():h.type==="mouseenter"||h.type==="mousemove"?(p(),u=setTimeout(()=>{M(I,!0)},400)):h.type==="mouseleave"&&p()}var L=$t(),C=S(L);let A;He(C,(h,N)=>e.diffViewModel.renderActionsViewZone?.(h,N),()=>({chunk:e.leaf,heightInPx:r(),onDomNodeTop:l}));var W=w(C,2);let se;W.__mousemove=_;var G=V(W);let te;var z=V(G),Y=h=>{ie(h,{size:1,variant:"ghost",color:"success",$$events:{click(...N){e.onAccept?.apply(this,N)}},children:(N,U)=>{var B=Ot();oe(S(B),{get keybinding(){return t().acceptFocusedChunk}}),g(N,B)},$$slots:{default:!0}})};H(z,h=>{a()||h(Y)});var Q=w(z,2);ie(Q,{size:1,variant:"ghost",color:"error",$$events:{click(...h){e.onReject?.apply(this,h)}},children:(h,N)=>{var U=Dt();oe(S(U),{get keybinding(){return t().rejectFocusedChunk}}),g(h,U)},$$slots:{default:!0}}),ce((h,N,U)=>{A=Ce(C,1,"svelte-1kwtokq",null,A,h),se=Ce(W,1,"c-chunk-action-panel-anchor svelte-1kwtokq",null,se,N),ze(W,`top: ${n(m)??""}px;`),te=Ce(G,1,"c-button-container svelte-1kwtokq",null,te,U)},[()=>({"c-chunk-diff-border--focused":!!e.leaf&&e.isFocused}),()=>({"c-chunk-action-panel-anchor--left":o()==="left","c-chunk-action-panel-anchor--right":o()==="right","c-chunk-action-panel-anchor--focused":e.isFocused}),()=>({"c-button-container--focused":e.isFocused,"c-button-container--transparent":n(I)})]),_e("mouseenter",W,_),_e("mouseleave",W,_),g(d,L),he(),s()}qe(["mousemove"]);var At=b('<span class="c-diff-page-counter svelte-17ip48s">Generating changes <!></span>'),Rt=b('<span class="c-diff-page-counter svelte-17ip48s"> <!></span>'),Pt=b('<span class="c-diff-page-counter svelte-17ip48s">No changes</span>'),Tt=b("<!> Back",1),Wt=b("<!> Next",1),jt=b("<!> Accept All",1),qt=b("<!> Reject All",1),zt=b("<!> <!>",1),Ut=b("<!> <!> <!>",1),Bt=b('<div class="c-top-action-panel-anchor svelte-17ip48s"><div class="c-button-container svelte-17ip48s"><!> <!> <!></div></div>');function Zt(d,e){ue(e,!0);const t=()=>x(e.diffViewModel,"$diffViewModel",r),i=()=>x(m,"$requestId",r),s=()=>x(n(_),"$isLoadingStore",r),o=()=>x(f,"$keybindingsStore",r),[r,a]=we(),f=e.diffViewModel.keybindings,m=e.diffViewModel.requestId;let l,u=F(()=>t().disableResolution),I=F(()=>t().disableApply),p=F(()=>t().currFocusedChunkIdx!==void 0?(t().currFocusedChunkIdx+1).toString():"x"),_=F(()=>t().isLoading),L=F(()=>!!t().leaves?.length),C=$("Copy request ID"),A=$(()=>{});function W(y){y||(clearTimeout(l),l=void 0,M(C,"Copy request ID"))}async function se(){i()&&(await navigator.clipboard.writeText(i()),M(C,"Copied!"),clearTimeout(l),l=setTimeout(n(A),1500))}var G=Bt(),te=V(G),z=V(te),Y=y=>{{let O=F(()=>[vt.Hover]);_t(y,{onOpenChange:W,get content(){return n(C)},get triggerOn(){return n(O)},get requestClose(){return n(A)},set requestClose(v){M(A,v,!0)},children:(v,R)=>{at(v,{variant:"ghost",color:"neutral",size:1,onclick:se,children:(j,P)=>{Ge(j,{name:"copy"})},$$slots:{default:!0}})},$$slots:{default:!0}})}};H(z,y=>{i()&&y(Y)});var Q=w(z,2),h=y=>{var O=At(),v=w(V(O));Pe(v,{size:1,get loading(){return s()}}),g(y,O)},N=y=>{var O=ke(),v=S(O),R=P=>{var c=Rt(),E=V(c),k=w(E);Pe(k,{size:1,get loading(){return s()}}),ce(()=>Ve(E,`${n(p)??""} of ${t()?.leaves?.length??""} `)),g(P,c)},j=P=>{var c=Pt();g(P,c)};H(v,P=>{n(L)?P(R):P(j,!1)},!0),g(y,O)};H(Q,y=>{!n(L)&&s()?y(h):y(N,!1)});var U=w(Q,2),B=y=>{var O=Ut(),v=S(O);ie(v,{size:1,variant:"ghost",color:"neutral",get onclick(){return e.diffViewModel.focusPrevChunk},children:(c,E)=>{var k=Tt();oe(S(k),{get keybinding(){return o().focusPrevChunk}}),g(c,k)},$$slots:{default:!0}});var R=w(v,2);ie(R,{size:1,variant:"ghost",color:"neutral",get onclick(){return e.diffViewModel.focusNextChunk},children:(c,E)=>{var k=Wt();oe(S(k),{get keybinding(){return o().focusNextChunk}}),g(c,k)},$$slots:{default:!0}});var j=w(R,2),P=c=>{var E=zt(),k=S(E),K=T=>{ie(T,{size:1,variant:"ghost",color:"success",get onclick(){return e.diffViewModel.acceptAllChunks},children:(re,fe)=>{var ge=jt();oe(S(ge),{get keybinding(){return o().acceptAllChunks}}),g(re,ge)},$$slots:{default:!0}})};H(k,T=>{x(n(I),"$disableApply",r)||T(K)});var J=w(k,2);ie(J,{size:1,variant:"ghost",color:"error",get onclick(){return e.diffViewModel.rejectAllChunks},children:(T,re)=>{var fe=qt();oe(S(fe),{get keybinding(){return o().rejectAllChunks}}),g(T,fe)},$$slots:{default:!0}}),g(c,E)};H(j,c=>{x(n(u),"$disableResolution",r)||c(P)}),g(y,O)};H(U,y=>{n(L)&&y(B)}),g(d,G),he(),a()}var Ht=(d,e)=>{d.key==="Enter"&&(e(),d.stopPropagation(),d.preventDefault())},Gt=b("<!> <!> <!> <!>",1),Yt=b("Close <!>",1),Kt=b('<div class="instruction-overlay-wrapper"><div></div> <div class="instruction-drawer-panel svelte-7w2pxx"><div class="instruction-drawer-panel__contents svelte-7w2pxx" tabindex="0" role="button"><div class="l-input-area__input svelte-7w2pxx"><!></div> <div class="c-instruction-drawer-panel__btn-container svelte-7w2pxx"><!> <!></div></div></div></div>'),Qt=b("<!> <!>",1);function Jt(d,e){ue(e,!0);const t=()=>x(A,"$modeStore",s),i=()=>x(W,"$selectionLinesStore",s),[s,o]=we();let r=ee(e,"initialConversation",19,()=>{}),a=ee(e,"initialFlags",19,()=>{});const f=wt.getContext().monaco,m={isWholeLine:!0,marginClassName:"instruction-edit-area-margin"},l=new Ke(pe);let u=new Ye(l,pe,gt().store,{initialConversation:r()});const I=u.currentConversationModel;let p;l.registerConsumer(u),yt(u);let _,L=$(void 0),C=$("");const A=e.diffViewModel.mode,W=e.diffViewModel.selectionLines;let se=F(()=>(t()===le.instruction?"Instruct":"Edit with")+" Augment... @ to focus on files or docs");function G(){const c=e.diffViewModel.getModifiedEditor(),E=Z(f);if(!c||!E||(_?.clear(),!i()))return;const k=i().start,K=i().end,J={range:new E.Range(k+1,1,K+1,1),options:m};_||(_=c.createDecorationsCollection()),_.set([J])}function te(){return!!n(C)?.trim()&&(e.diffViewModel.handleInstructionSubmit(n(C)),!0)}Le(async()=>{await Se(),B(),M(z,e.diffViewModel.editorOffset,!0)}),Ue(()=>{p?.destroy(),_?.clear()});let z=$(0),Y=$(57),Q=F(()=>x(e.diffViewModel,"$diffViewModel",s).isLoading);be(()=>{if(n(L)){if(i()==null)M(Y,0);else{const c=n(L).scrollHeight;M(Y,Math.min(40+c,108),!0)}p?.update({heightInPx:n(Y)}),G()}});let h=$(void 0),N=$(void 0);const U=()=>n(h)?.requestFocus(),B=()=>n(h)?.forceFocus(),y=c=>{I.saveDraftMentions(c.current)};function O(c){M(C,c.rawText,!0)}var v=Qt(),R=S(v);(function(c,E){ue(E,!0);const k=ee(E,"featureFlags",19,()=>({})),K=ht();Le(()=>{k()&&K(ft({areFlagsReady:!0,...k()}))}),he()})(0,{get featureFlags(){return a()}});var j=w(R,2),P=c=>{var E=Kt(),k=V(E);He(k,X=>function(ae){const q=i()?i().start:1;return p=e.diffViewModel.renderInstructionsDrawerViewZone(ae,{line:q,heightInPx:n(Y),onDomNodeTop:ve=>{M(z,e.diffViewModel.editorOffset+ve)},autoFocus:!0}),G(),{destroy(){p&&(p.destroy(),p=void 0),_&&(_.clear(),_=void 0)}}}(X));var K=w(k,2),J=V(K);J.__click=B,J.__keydown=[Ht,B];var T=V(J),re=V(T);Ne(re,()=>We.Root,(X,ae)=>{ye(ae(X,{focusOnInit:!0,children:(q,ve)=>{var me=Gt(),Oe=S(me);Ct(Oe,{shortcuts:{Enter:()=>te()}});var De=w(Oe,2);ye(kt(De,{requestEditorFocus:U,onMentionItemsUpdated:y}),Me=>M(N,Me,!0),()=>n(N));var $e=w(De,2);Ne($e,()=>We.Content,(Me,et)=>{et(Me,{get content(){return n(C)},onContentChanged:O})});var Xe=w($e,2);bt(Xe,{get placeholder(){return n(se)}}),g(q,me)},$$slots:{default:!0}}),q=>M(h,q,!0),()=>n(h))}),ye(T,X=>M(L,X),()=>n(L));var fe=w(T,2),ge=V(fe);ie(ge,{id:"close",size:1,variant:"soft",color:"neutral",title:"Close",get onclick(){return e.diffViewModel.disposeDiffViewPanel},children:(X,ae)=>{var q=Yt();oe(w(S(q)),{keybinding:"esc"}),g(X,q)},$$slots:{default:!0}});var Je=w(ge,2);{let X=F(()=>t()===le.instruction?"Instruct Augment":"Edit with Augment"),ae=F(()=>!n(C).trim()||x(n(Q),"$isLoadingStore",s));ie(Je,{id:"send",size:1,variant:"solid",color:"accent",get title(){return n(X)},get disabled(){return n(ae)},onclick:te,children:(q,ve)=>{var me=it();ce(()=>Ve(me,t()===le.instruction?"Instruct":"Edit")),g(q,me)},$$slots:{default:!0,iconRight:(q,ve)=>{Ge(q,{slot:"iconRight",name:"send-horizontal"})}}})}ce(()=>ze(K,`top: ${n(z)??""}px; height: ${n(Y)??""}px;`)),g(c,E)};H(j,c=>{i()&&c(P)}),g(d,v),he(),o()}qe(["click","keydown"]);var Xt=b('<div class="sticky-top svelte-1nhwlxa"><!></div> <!>',1),ei=b('<div class="diff-view-container svelte-1nhwlxa"><!> <div class="editor-container svelte-1nhwlxa"><div class="editor svelte-1nhwlxa"></div> <!></div></div>');rt(function(d,e){ue(e,!0);const t=()=>x(nt,"$themeStore",s),i=()=>x(n(r),"$diffViewModel",s),[s,o]=we();let r=$(void 0),a=$(void 0),f=F(()=>n(r)?.disableApply),m=F(()=>n(r)?.disableResolution);function l(C){const A=ot.dark;return Et(C?.category||A,C?.intensity)??It.get(A)}be(()=>{const C=t();n(r)&&n(r)?.updateTheme(l(C))});let u=$(void 0);be(()=>{n(u)&&n(a)&&!n(r)&&st(M(r,new Lt(n(a),l(t()),n(u)),!0),"$diffViewModel",s)}),Le(async()=>{M(u,await window.augmentDeps.monaco,!0),n(u)||console.error("Monaco not loaded. Diff view cannot be initialized.")}),Ue(()=>{n(r)?.dispose()});let I=F(()=>i()?.leaves),p=$(!1);be(()=>{n(r)?.updateIsWebviewFocused(n(p))});var _=ke();_e("message",Ie,function(...C){n(r)?.handleMessageFromExtension?.apply(this,C)}),_e("focus",Ie,()=>M(p,!0)),_e("blur",Ie,()=>M(p,!1));var L=S(_);Ne(L,()=>Mt.Root,(C,A)=>{A(C,{children:(W,se)=>{mt(W,{children:(G,te)=>{pt(G,{children:(z,Y)=>{var Q=ei(),h=V(Q),N=v=>{var R=Xt(),j=S(R);Zt(V(j),{get diffViewModel(){return i()}}),Jt(w(j,2),{get diffViewModel(){return i()}}),g(v,R)};H(h,v=>{i()&&v(N)});var U=w(h,2),B=V(U);ye(B,v=>M(a,v),()=>n(a));var y=w(B,2),O=v=>{var R=ke(),j=S(R);Be(j,17,()=>n(I),Ze,(P,c,E)=>{var k=ke(),K=S(k),J=T=>{{let re=F(()=>i()?.currFocusedChunkIdx===E);Ft(T,{get isFocused(){return n(re)},onAccept:()=>i()?.acceptChunk(n(c)),onReject:()=>i()?.rejectChunk(n(c)),get diffViewModel(){return i()},get leaf(){return n(c)},align:"right",get disableApply(){return x(n(f),"$disableApply",s)}})}};H(K,T=>{n(c).unitOfCodeWork.modifiedCode!==n(c).unitOfCodeWork.originalCode&&T(J)}),g(P,k)}),g(v,R)};H(y,v=>{i()&&n(I)?.length&&!x(n(m),"$disableResolution",s)&&v(O)}),g(z,Q)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}})}),g(d,_),he(),o()},{target:document.getElementById("app")});
//# sourceMappingURL=diff-view-B9V3322o.js.map
